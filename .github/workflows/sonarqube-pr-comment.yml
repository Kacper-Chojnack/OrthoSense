name: SonarCloud PR Comment

on:
  workflow_run:
    workflows: ["SonarCloud Analysis"]
    types: [completed]

jobs:
  pr-comment:
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'success'
    steps:
      - name: Get PR Number
        id: pr
        run: |
          PR_NUMBER=$(jq -r '.pull_request.number // empty' $GITHUB_EVENT_PATH)
          echo "number=$PR_NUMBER" >> $GITHUB_OUTPUT

      - name: Comment PR with SonarCloud Results
        if: steps.pr.outputs.number != ''
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = ${{ steps.pr.outputs.number }};
            // Adjust this URL to your actual SonarCloud project URL
            const sonarUrl = 'https://sonarcloud.io/summary/new_code?id=Kacper-Chojnack_OrthoSense';
            
            const comment = `## ğŸ” SonarCloud Analysis Results
            
            âœ… Analysis completed successfully!
            
            ### View Results:
            - ğŸ“Š Coverage: [Check Dashboard](${sonarUrl})
            - ğŸ› Bugs: [Check Dashboard](${sonarUrl})
            - ğŸ”’ Vulnerabilities: [Check Dashboard](${sonarUrl})
            - ğŸ’© Code Smells: [Check Dashboard](${sonarUrl})
            
            [View Full Report on SonarCloud](${sonarUrl}) ğŸ“ˆ
            
            _Note: Quality Gate results are informational. Focus on improving code quality over time._`;
            
            if (prNumber) {
              github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                body: comment
              });
            }
